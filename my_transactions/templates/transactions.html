{% extends 'base.html'%}
{%load static %}
{% block content %}
<div id="pk_validation">
  <div class="container">
    <div class="row">
      <div class="col-12 text-center mx-auto">
        <form method="POST" action="{% url 'validate_key' %}">
          {% csrf_token %}
          <label for="private_key">Enter your private key:</label>
          <input type="text" name="private_key" id="private_key" required>
          <button type="submit">Validate</button>
          <div id="response"></div>
        </form>
      </div>
    </div>
  </div>
</div>
<div id="transactions-main">
  <div class="container-fluid">
    <div class="row">
      <div class="col text-center mx-auto m-3">
        <h1>Transactions</h1>
        <div class="board py-2">
          <div class="task-container">
            <div class="text-start task" id="task-{{ application.id }}">
              <div class="field">
                <h2>Balance : {{profile.balance}}</h2>
              </div>

              <div class="d-flex text-center">
                <a href="{% url 'send_payment'%}" class="new-appl-view text-decoration-none fw-bold px-2">Send
                  Payment</a>
              </div>
            </div>
          </div>
        </div>
        <p> Sending address: {{profile.sending_address}}</p>
        <p>Receiving address: {{profile.receiving_address}}</p>

        <a href="{% url 'process_payment' %}" id="top-up-link">Top Up</a>
        <a href="{% url 'transactions_history' %}">History</a>
      </div>

      <script>
        document.querySelector("form").onsubmit = async (e) => {
          e.preventDefault();
          const formData = new FormData(e.target);
          const response = await fetch("{% url 'validate_key' %}", {
            method: "POST",
            body: formData,
            headers: {
              'X-CSRFToken': '{{ csrf_token }}'
            }
          });
          const result = await response.json();
          if (result.status === 'success') {
            document.getElementById('transactions-main').style.display = 'unset';
            document.getElementById("pk_validation").style.display = 'none';
            document.getElementById("response").style.display = 'none';
          } else {
            document.getElementById("response").innerText = result.message;
          }
        };
      </script>
      {% endblock %}